---
title: CSS选择器优先级
date: 2020-05-20 20:20:41
tags:
---

# CSS选择器优先级

在开发中，有时候需要自定义某些元素的样式，使其覆盖已有的框架样式，但是发现无论自己怎么编写或者是用了`!important`之后，样式还是没有改变。其实，这跟CSS选择器的优先级有关。


如果让我们说出简单的优先级次序，我们肯定知道：

`内联 > IDx选择器 > 类选择器 > 标签选择器`

但是，我们实际的使用过程中会发现，貌似没有这么简单。只有理解浏览器在构造CSS样式的优先级算法原理，我们才能真正的吃透这些。

## CSS选择器优先级计算原理

在《CSS REFACTORING》中提到了算法的过程：

CSS选择器的优先级是由 A 、B、C、D 的值来决定的，其中它们的值计算规则如下：

1. 如果存在内联样式，那么 A = 1, 否则 A = 0;
2. B 的值等于 ID选择器 出现的次数;
3. C 的值等于 类选择器 和 属性选择器 和 伪类 出现的总次数;
4. D 的值等于 标签选择器 和 伪元素 出现的总次数 。

可能不是很明了，我们通过例子来解释：

`#nav-top > ul > li[data-type=0] > a.link`

对于这段选择器，我们根据上述的规则，可以得知，A = 0， B = 1， C = 2, D = 3。

上面计算出来的四个值可以简化成`(0, 1, 2, 3)`。

比如再看下面的例子：

|选择器|优先级值|
|:--|:--|
|li| (0, 0, 0, 1) |
|ul li| (0, 0, 0, 2) |
|ul ol+li| (0, 0, 0, 3) |
|h1 + *[REL=up]| (0, 0, 1, 1) |
|ul ol li.red| (0, 0, 1, 3) |
|li.red.level| (0, 0, 2, 1) |
|a1.a2.a3.a4.a5.a6.a7.a8| (0, 0, 8, 0) |
|#nav| (0, 1, 0, 0) |
|li:first-child h2 .title| (0, 0, 2, 2) |
|#nav .selected > a:hover| (0, 1, 2, 1) |
|html body #nav .selected > a::before| (0, 1, 1, 4) |

认真思考上面的几个例子，看完之后应该很容易理解优先级是怎么计算的了。知道优先级怎么算的之后，我们需要知道优先级究竟是怎么去比较的：

**比较规则是: 从左往右依次进行比较 ，较大者胜出，如果相等，则继续往右移动一位进行比较 。如果4位全部相等，则后面的会覆盖前面的**

看一个例子：

```html
<style>
#nav-list .item {
	color: red;
}
.nav-list .item {
	color: green;
}
</style>


<div class="nav-list" id="nav-list">
	<div class="item">nav1</div>
	<div class="item">nav2</div>
</div>
```

例子中的两个样式都是对`.item`的div元素进行颜色设置，从优先级值来看，`#nav-list .item` 为 `(0, 1, 1, 0)`，`.nav-list .item` 为 `(0, 0, 2, 0)`。因为第一位都是0，所以进入第二位比较，由于第二位中`1 > 0`，所以采用`#nav-list .item`的样式，最终字体颜色为红色。

## 特殊的`!important`

从上面的优先级算法来看，内联样式的优先级是最高的，其实我们可以通过在外部样式中设置`!important`来覆盖内联样式。当然一般情况下，为了便于维护很少使用内联样式，所以基本上也很少用到`!important`。如果不是为了覆盖内联样式，建议尽量不要用`!important`。

说到这里，可能会有这种情况，如果内联样式里面用了`!important`，那外部样式是不是就没用了呢？比如下面的代码：

```html
<style>
  .title {
    color: blue !important;
  }
</style>
<h1 class="title" style="color:red !important;">标题</h1>
```

没错，这种情况下内联样式的属性已经强大到不管你外部样式怎么写都没法覆盖它了。切记，在实际的开发中，这种情况需要杜绝（除非你真的需要这样做）。

那真的不存在外部样式覆盖内联`!important`了吗？

从单个样式属性的角度来说，是的，不存在了。但是如果从某一个元素的样式呈现结果来说，有可能。具体，看如下例子：

```html
<style>
.box {
	max-width: 100px;
}
</style>
<div class="box" style="background: #f00; width: 300px !important;">我的宽度是多少呢？<div>
```
这时候，`.box`的宽度只有100px，而不是内联中的300px。但是请注意，他们的属性不同哦，外部中是`max-width`，所以可见，`max-width`可以超越`width !important`。不过，这里已经不是优先级的问题了，因为优先级比较的是同一个样式属性，而`max-with`和`width`是两个不同的属性。通常的，`max/min-width`的属性效果高于`width`，所以如果在开发中发现无论怎么设置`width`都不生效，那得看看是不是有`max/min-width`哦。

关于`!important`的使用，业界一般遵循以下约定：

1. 永远不要在全局CSS规则中使用;
2. 永远不要在自制的插件/组件中使用;
3. 只在需要覆盖全局或外部插件的css规则的特定页面中才使用;
4. 首先考虑使用优先级来解决问题而不是`!important`。